{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Signed Leave Request Package",
  "description": "JSON schema for CDBL Leave Companion app export. Matches Prisma LeaveRequest model with security metadata.",
  "type": "object",
  "required": ["data", "signature", "timestamp", "expiry"],
  "properties": {
    "data": {
      "type": "object",
      "description": "Leave request data matching Prisma LeaveRequest model",
      "required": ["type", "startDate", "endDate", "reason", "needsCertificate", "status", "policyVersion"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["CASUAL", "MEDICAL", "EARNED", "EXTRAWITHPAY", "EXTRAWITHOUTPAY", "MATERNITY", "PATERNITY", "STUDY", "SPECIAL_DISABILITY", "QUARANTINE"],
          "description": "Leave type enum matching Prisma LeaveType"
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "ISO8601 formatted start date (inclusive)"
        },
        "endDate": {
          "type": "string",
          "format": "date-time",
          "description": "ISO8601 formatted end date (inclusive)"
        },
        "workingDays": {
          "type": "integer",
          "minimum": 1,
          "description": "Calculated calendar days: (endDate - startDate) + 1"
        },
        "reason": {
          "type": "string",
          "minLength": 10,
          "maxLength": 500,
          "description": "Reason for leave request"
        },
        "needsCertificate": {
          "type": "boolean",
          "description": "True if medical certificate required (MEDICAL > 3 days)"
        },
        "status": {
          "type": "string",
          "enum": ["DRAFT", "SUBMITTED", "PENDING", "APPROVED", "REJECTED", "CANCELLED"],
          "description": "Leave status enum matching Prisma LeaveStatus"
        },
        "policyVersion": {
          "type": "string",
          "pattern": "^v\\d+\\.\\d+$",
          "description": "Policy version snapshot (e.g., 'v1.1')"
        },
        "certificateUrl": {
          "type": ["string", "null"],
          "description": "Optional URL to medical certificate (for future web app integration)"
        }
      }
    },
    "signature": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "Hex-encoded HMAC-SHA256 signature of the data payload"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 formatted creation timestamp"
    },
    "expiry": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 formatted expiry timestamp (timestamp + 24 hours)"
    }
  },
  "examples": [
    {
      "data": {
        "type": "MEDICAL",
        "startDate": "2025-11-01T00:00:00Z",
        "endDate": "2025-11-05T00:00:00Z",
        "workingDays": 5,
        "reason": "Medical treatment and recovery period required",
        "needsCertificate": true,
        "status": "DRAFT",
        "policyVersion": "v1.1"
      },
      "signature": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
      "timestamp": "2025-10-31T12:00:00Z",
      "expiry": "2025-11-01T12:00:00Z"
    },
    {
      "data": {
        "type": "CASUAL",
        "startDate": "2025-11-10T00:00:00Z",
        "endDate": "2025-11-12T00:00:00Z",
        "workingDays": 3,
        "reason": "Family event and personal commitments",
        "needsCertificate": false,
        "status": "DRAFT",
        "policyVersion": "v1.1"
      },
      "signature": "fedcba0987654321fedcba0987654321fedcba0987654321fedcba0987654321",
      "timestamp": "2025-11-05T08:30:00Z",
      "expiry": "2025-11-06T08:30:00Z"
    }
  ]
}

